# LDPred2 Pipeline

This describes how we use ldpred2. The main script we utilize is `/var/genetics/proj/within_family/within_family_project/scripts/ldpred2/runldpred2.R` which acts as a command line tool. 

## Overview

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcblx0YmVkZmlsZVtUYXJnZXQvSG9sZG91dCBTYW1wbGVdIC0tPiBzY3JpcHRbcnVubGRwcmVkMi5SXVxuXHRzdW1zdGF0c1tHV0FTL0ZHV0FTIGJldGFzXSAtLT4gc2NyaXB0XG5cdHNjcmlwdCAtLT4gb3V0cHV0W1BHSXMgZm9yIGV2ZXJ5IGluZGl2aWR1YWwgaW4gc3Vtc3RhdHNdIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjp0cnVlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6dHJ1ZX0)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggVERcblx0YmVkZmlsZVtUYXJnZXQvSG9sZG91dCBTYW1wbGVdIC0tPiBzY3JpcHRbcnVubGRwcmVkMi5SXVxuXHRzdW1zdGF0c1tHV0FTL0ZHV0FTIGJldGFzXSAtLT4gc2NyaXB0XG5cdHNjcmlwdCAtLT4gb3V0cHV0W1BHSXMgZm9yIGV2ZXJ5IGluZGl2aWR1YWwgaW4gc3Vtc3RhdHNdIiwibWVybWFpZCI6IntcbiAgXCJ0aGVtZVwiOiBcImRlZmF1bHRcIlxufSIsInVwZGF0ZUVkaXRvciI6dHJ1ZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOnRydWV9)

## Looking inside `runldpred2.R`
First we look at what happens to the bed file which is supposed to be our holdout sample.

### Preprocessing the files

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggTFJcblx0YmVkZmlsZVtIb2xkb3V0IFNhbXBsZV0gLS0-IHxpbXBvcnRfdmFsaWRhdGlvbl9iZWR8aW5iZWRbUmVhZGluZyBpbiBiZWQgZmlsZSBhcyA8YnI-IG9iai5iaWdTTlBdXG5cdFxuXHRpbmJlZCAtLT4gbWFwW01hcCBGaWxlIDxicj4gU05QIGlkZW50aWZpZXJzLiBgbWFwYF1cblx0aW5iZWQgLS0-IGdlbm90eXBlW0dlbm90eXBlIE1hdHJpeC4gYGdlbm90eXBlc2BdXG5cdGluYmVkIC0tPiBmYW1bSW5kaXZpZHVhbCBJRHMuIGBkZi5vdXRgXSIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggVERcblx0YVtXZWlnaHRzIGZyb20gTERQcmVkXSAtLT4gfGxkcHJlZF9iZXRhIGNvbHVtbnwgZFtmUEdTXVxuXHRiW0JlZCBmaWxlcyA8YnI-IG9icnNlcnZlZCBnZW5vdHlwZXNdLS0-IGRcblx0Y1tJbXB1dGF0ZWQgcGFyZW50YWwgZ2Vub3R5cGVzIDxicj4gaGRmNSBmaWxlXSAtLT4gZCBcblx0XG5cdGQgLS0-IG91dHB1dFtQR0ksIFBHSV9tLCBQR0lfZl0iLCJtZXJtYWlkIjoie1xuICBcInRoZW1lXCI6IFwiZGVmYXVsdFwiXG59IiwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)

Lets look at what happens to the sumstats file. We clean it first:

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggTFJcblx0c3Vtc3RhdFtHV0FTL0ZHV0FTIGJldGFzXSAtLT4gZHVwW0Ryb3AgZHVwbHVjYXRlIFNOUHNdXG5cdHN1bXN0YXQgLS0-IGJldGFbSWRlbnRpZnkgYW5kIG5hbWUgdGhlIGNvcnJlY3QgPGJyPiBlZmZlY3QgZXN0aW1hdGUgPGJyPiBpZSBiZXRhLCB6LXNjb3JlLCBvZGRzIHJhdGlvXVxuXHRzdW1zdGF0IC0tPiBhbWJpZ1tSZW1vdmUgQW1iaWd1b3VzIEFsbGVsZXNdXG5cdHN1bXN0YXQgLS0-IGhtM1tGaWx0ZXIgZm9yIGhhcG1hcDMgU05Qc11cblx0c3Vtc3RhdCAtLT4gcmVuYW1lW1JlbmFtZSBjb2x1bW4gbmFtZXMgdG8gdXNlIGluIExEcHJlZDJdIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggTFJcblx0YmVkZmlsZVtIb2xkb3V0IFNhbXBsZV0gLS0-IHxpbXBvcnRfdmFsaWRhdGlvbl9iZWR8aW5iZWRbUmVhZGluZyBpbiBiZWQgZmlsZSBhcyA8YnI-IG9iai5iaWdTTlBdXG5cdFxuXHRpbmJlZCAtLT4gbWFwW01hcCBGaWxlIDxicj4gU05QIGlkZW50aWZpZXJzLiBgbWFwYF1cblx0aW5iZWQgLS0-IGdlbm90eXBlW0dlbm90eXBlIE1hdHJpeC4gYGdlbm90eXBlc2BdXG5cdGluYmVkIC0tPiBmYW1bSW5kaXZpZHVhbCBJRHMuIGBkZi5vdXRgXSIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9)

### Analysis
Once we processed the holdout file and the sumstat file we start using them together.
First we use them to construct the LD matrix

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggTFJcblx0XG5cdHN1bXN0YXRbQ2xlYW5lZCBTdW1zdGF0XSAtLT4gaW5mb3NucFtNZXJnZSBpbnRvIGBpbmZvX3NucGBdXG5cdG1hcFtNYXAgZmlsZSBmcm9tIGhvbGRvdXRdIC0tPiBpbmZvc25wXG5cdFxuXHRnZW5vdHlwZXNbR2Vub3R5cGUgTWF0cml4IGZyb20gaG9sZG91dF0gLS0-IGxkW0NvbnN0cnVjdCBMRCBNYXRyaXhdXG5cdGluZm9zbnAgLS0-IGxkIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggTFJcblx0c3Vtc3RhdFtHV0FTL0ZHV0FTIGJldGFzXSAtLT4gZHVwW0Ryb3AgZHVwbHVjYXRlIFNOUHNdXG5cdHN1bXN0YXQgLS0-IGJldGFbSWRlbnRpZnkgYW5kIG5hbWUgdGhlIGNvcnJlY3QgPGJyPiBlZmZlY3QgZXN0aW1hdGUgPGJyPiBpZSBiZXRhLCB6LXNjb3JlLCBvZGRzIHJhdGlvXVxuXHRzdW1zdGF0IC0tPiBhbWJpZ1tSZW1vdmUgQW1iaWd1b3VzIEFsbGVsZXNdXG5cdHN1bXN0YXQgLS0-IGhtM1tGaWx0ZXIgZm9yIGhhcG1hcDMgU05Qc11cblx0c3Vtc3RhdCAtLT4gcmVuYW1lW1JlbmFtZSBjb2x1bW4gbmFtZXMgdG8gdXNlIGluIExEcHJlZDJdIiwibWVybWFpZCI6IntcbiAgXCJ0aGVtZVwiOiBcImRlZmF1bHRcIlxufSIsInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)


Then we get an estimate $h^2$ (heritability) by running an LD Score regression

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggTFJcblx0XG5cdGluZm9zbnBbYGluZm9fc25wYF0gLS0-IGxkc2NbTEQgU2NvcmUgUmVncmVzc2lvbl1cblx0bGRbTEQgTWF0cml4XSAtLT4gbGRzY1xuXHRcblx0bGRzYyAtLT4gaDJbSGVyaXRhYmlsaXR5IGVzdGltYXRlXSIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggTFJcblx0XG5cdHN1bXN0YXRbQ2xlYW5lZCBTdW1zdGF0XSAtLT4gaW5mb3NucFtNZXJnZSBpbnRvIGBpbmZvX3NucGBdXG5cdG1hcFtNYXAgZmlsZSBmcm9tIGhvbGRvdXRdIC0tPiBpbmZvc25wXG5cdFxuXHRnZW5vdHlwZXNbR2Vub3R5cGUgTWF0cml4IGZyb20gaG9sZG91dF0gLS0-IGxkW0NvbnN0cnVjdCBMRCBNYXRyaXhdXG5cdGluZm9zbnAgLS0-IGxkIiwibWVybWFpZCI6IntcbiAgXCJ0aGVtZVwiOiBcImRlZmF1bHRcIlxufSIsInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)


Finally we can calculate the PGI weights

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggTFJcblx0bGRbTEQgTWF0cml4XSAtLT4gcGdpW1BHSSBXZWlnaHRzIHVzaW5nIGBzbnBfbGRwcmVkMl9hdXRvYF1cblx0aW5mb3NucFtgaW5mb19zbnBgXSAtLT4gcGdpXG5cdGgyW0hlcml0YWJpbGl0eV0gLS0-IHBnaVxuXHRcblx0XG5cdHBnaSAtLS0gfG1lcmdlIHdpdGh8IG1hcFtNYXAgRmlsZV0gLS0-IE91dHB1dCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggTFJcblx0XG5cdGluZm9zbnBbYGluZm9fc25wYF0gLS0-IGxkc2NbTEQgU2NvcmUgUmVncmVzc2lvbl1cblx0bGRbTEQgTWF0cml4XSAtLT4gbGRzY1xuXHRcblx0bGRzYyAtLT4gaDJbSGVyaXRhYmlsaXR5IGVzdGltYXRlXSIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9)


This is the result of interest. But the script can also calculate the final scores and output
that as well

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggTFJcblx0Z2Vub3R5cGVzW0dlbm90eXBlcyBEYXRhXSAtLT4gcGdpW1BHSSBTY29yZXNdXG5cdHd0W1BHSSBXZWlnaHRzXSAtLT4gcGdpXG5cdFxuXHRwZ2kgLS0tIHxtZXJnZSB3aXRofCBmYW1bSW5kaXZpZHVhbCBJRCBkYXRhIGBkZi5vdXRgXSAtLT4gT3V0cHV0IiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/edit/##eyJjb2RlIjoiZ3JhcGggTFJcblx0bGRbTEQgTWF0cml4XSAtLT4gcGdpW1BHSSBXZWlnaHRzIHVzaW5nIGBzbnBfbGRwcmVkMl9hdXRvYF1cblx0aW5mb3NucFtgaW5mb19zbnBgXSAtLT4gcGdpXG5cdGgyW0hlcml0YWJpbGl0eV0gLS0-IHBnaVxuXHRcblx0XG5cdHBnaSAtLS0gfG1lcmdlIHdpdGh8IG1hcFtNYXAgRmlsZV0gLS0-IE91dHB1dCIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9)